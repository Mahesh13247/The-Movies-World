import{u as _,r as m,j as a,B as u}from"./index-BCefjz6N.js";function $(){const{t:g}=_(),[o,c]=m.useState(()=>JSON.parse(localStorage.getItem("movieLists")||"[]")),[v,b]=m.useState(""),[A,f]=m.useState(null),[p,y]=m.useState(""),[h,M]=m.useState(""),[j,I]=m.useState("favoritesFirst"),[L,D]=m.useState("added"),C=m.useRef(null),w=()=>{if(!v.trim())return;if(o.some(s=>s.name.toLowerCase()===v.trim().toLowerCase())){u.error("List name already exists!");return}const e=[...o,{name:v.trim(),movies:[],favorite:!1,createdAt:Date.now()}];c(e),localStorage.setItem("movieLists",JSON.stringify(e)),b("")},F=e=>{const s=o.filter((t,i)=>i!==e);c(s),localStorage.setItem("movieLists",JSON.stringify(s))},N=(e,s)=>{if(!s.trim())return;if(o.some((i,n)=>n!==e&&i.name.toLowerCase()===s.trim().toLowerCase())){u.error("List name already exists!");return}const t=o.map((i,n)=>n===e?{...i,name:s.trim()}:i);c(t),localStorage.setItem("movieLists",JSON.stringify(t))},J=(e,s)=>{const t=typeof s=="string"?s:((s==null?void 0:s.title)||(s==null?void 0:s.name)||"").toString();if(!t.trim()){u.error("Please provide a movie title");return}const i=o.map((n,r)=>r!==e?n:n.movies.some(l=>(typeof l=="string"?l:(l==null?void 0:l.title)||(l==null?void 0:l.name)||"").trim().toLowerCase()===t.trim().toLowerCase())?(u.info("Movie already in list"),n):{...n,movies:[...n.movies,s]});c(i),localStorage.setItem("movieLists",JSON.stringify(i))},R=(e,s)=>{const t=o.map((i,n)=>n===e?{...i,movies:i.movies.filter((r,d)=>d!==s)}:i);c(t),localStorage.setItem("movieLists",JSON.stringify(t))},E=e=>{const s=o.map((t,i)=>i===e?{...t,movies:[]}:t);c(s),localStorage.setItem("movieLists",JSON.stringify(s))},T=e=>{const s=o[e];if(!s)return;let t=`${s.name} Copy`;const i=new Set(o.map(d=>d.name.toLowerCase()));let n=2;for(;i.has(t.toLowerCase());)t=`${s.name} Copy ${n++}`;const r=[...o,{...s,name:t,favorite:!1,createdAt:Date.now()}];c(r),localStorage.setItem("movieLists",JSON.stringify(r))},U=e=>{const s=o.map((t,i)=>i===e?{...t,favorite:!t.favorite}:t);c(s),localStorage.setItem("movieLists",JSON.stringify(s))},k=(e,s,t)=>{const i=o[e];if(!i)return;const n=s+t;if(n<0||n>=i.movies.length)return;const r=[...i.movies],[d]=r.splice(s,1);r.splice(n,0,d);const l=o.map((S,K)=>K===e?{...S,movies:r}:S);c(l),localStorage.setItem("movieLists",JSON.stringify(l))},B=()=>{const e=new Blob([JSON.stringify(o,null,2)],{type:"application/json"}),s=URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download="movieLists.json",t.click(),URL.revokeObjectURL(s)},Z=async e=>{try{const s=await e.text(),t=JSON.parse(s);if(!Array.isArray(t))throw new Error("Invalid format");const i=t.map(n=>({name:((n==null?void 0:n.name)||"").toString().trim()||"Untitled",movies:Array.isArray(n==null?void 0:n.movies)?n.movies:[],favorite:!!(n!=null&&n.favorite),createdAt:(n==null?void 0:n.createdAt)||Date.now()}));c(i),localStorage.setItem("movieLists",JSON.stringify(i)),u.success("Lists imported")}catch{u.error("Failed to import lists")}},O=m.useMemo(()=>{const e=h.trim().toLowerCase();let s=o.filter(t=>!e||t.name.toLowerCase().includes(e));switch(j){case"nameAsc":s.sort((t,i)=>t.name.localeCompare(i.name));break;case"nameDesc":s.sort((t,i)=>i.name.localeCompare(t.name));break;case"sizeDesc":s.sort((t,i)=>{var n,r;return(((n=i.movies)==null?void 0:n.length)||0)-(((r=t.movies)==null?void 0:r.length)||0)});break;case"favoritesFirst":default:s.sort((t,i)=>i.favorite===t.favorite?t.name.localeCompare(i.name):i.favorite?1:-1);break}return s},[o,h,j]),z=e=>L==="titleAsc"?[...e].sort((s,t)=>x(s).localeCompare(x(t))):L==="titleDesc"?[...e].sort((s,t)=>x(t).localeCompare(x(s))):e,x=e=>typeof e=="string"?e:(e==null?void 0:e.title)||(e==null?void 0:e.name)||"";return a.jsxs("section",{className:"movie-lists-section",children:[a.jsx("div",{className:"ml-header",children:a.jsxs("h2",{className:"ml-title",children:["ðŸŽžï¸ ",g("movie_lists")]})}),a.jsxs("div",{className:"ml-controls",children:[a.jsx("input",{value:v,onChange:e=>b(e.target.value),placeholder:"New list name",onKeyDown:e=>{e.key==="Enter"&&w()},"aria-label":"New list name"}),a.jsx("button",{className:"ml-btn primary",onClick:w,disabled:!v.trim(),children:"Add List"}),a.jsx("input",{value:h,onChange:e=>M(e.target.value),placeholder:"Filter lists","aria-label":"Filter lists"}),a.jsxs("select",{className:"ml-select",value:j,onChange:e=>I(e.target.value),"aria-label":"Sort lists",children:[a.jsx("option",{value:"favoritesFirst",children:"Favorites first"}),a.jsx("option",{value:"nameAsc",children:"Name Aâ€“Z"}),a.jsx("option",{value:"nameDesc",children:"Name Zâ€“A"}),a.jsx("option",{value:"sizeDesc",children:"Most movies"})]}),a.jsxs("select",{className:"ml-select",value:L,onChange:e=>D(e.target.value),"aria-label":"Sort movies in a list",children:[a.jsx("option",{value:"added",children:"By added order"}),a.jsx("option",{value:"titleAsc",children:"Title Aâ€“Z"}),a.jsx("option",{value:"titleDesc",children:"Title Zâ€“A"})]}),a.jsx("button",{className:"ml-btn",onClick:B,children:"Export"}),a.jsx("button",{className:"ml-btn",onClick:()=>{var e;return(e=C.current)==null?void 0:e.click()},children:"Import"}),a.jsx("input",{ref:C,type:"file",accept:"application/json",style:{display:"none"},onChange:e=>{var t;const s=(t=e.target.files)==null?void 0:t[0];s&&Z(s),e.target.value=""}})]}),a.jsx("ul",{className:"ml-lists",children:O.length===0?a.jsx("li",{className:"ml-empty",children:"No lists yet."}):O.map((e,s)=>a.jsxs("li",{className:"ml-card",children:[A===s?a.jsxs(a.Fragment,{children:[a.jsx("input",{value:p,onChange:t=>y(t.target.value),onBlur:()=>{N(s,p),f(null)},onKeyDown:t=>{t.key==="Enter"&&(N(s,p),f(null))},autoFocus:!0}),a.jsx("button",{className:"ml-btn primary",onClick:()=>{N(s,p),f(null)},children:"Save"}),a.jsx("button",{className:"ml-btn",onClick:()=>f(null),children:"Cancel"})]}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"ml-card-title",children:[a.jsx("span",{className:"ml-name",children:e.name}),a.jsxs("span",{className:"ml-count",children:[e.movies.length," movies"]})]}),a.jsxs("div",{className:"ml-actions",children:[a.jsx("button",{className:"ml-icon-btn",onClick:()=>U(o.indexOf(e)),"aria-pressed":!!e.favorite,title:e.favorite?"Unfavorite":"Favorite",children:e.favorite?"â˜…":"â˜†"}),a.jsx("button",{className:"ml-btn",onClick:()=>{f(s),y(e.name)},children:"Rename"}),a.jsx("button",{className:"ml-btn danger",onClick:()=>F(o.indexOf(e)),children:"Delete"}),a.jsx("button",{className:"ml-btn",onClick:()=>T(o.indexOf(e)),children:"Duplicate"}),a.jsx("button",{className:"ml-btn",onClick:()=>E(o.indexOf(e)),children:"Clear Movies"})]})]}),e.movies.length>0&&a.jsx("ul",{className:"ml-movies",children:z(e.movies).map((t,i)=>a.jsxs("li",{className:"ml-movie-chip",children:[typeof t=="string"?t:t.title||t.name||"Untitled",a.jsx("button",{className:"ml-icon-btn",onClick:()=>k(o.indexOf(e),i,-1),"aria-label":"Move up",title:"Move up",children:"â†‘"}),a.jsx("button",{className:"ml-icon-btn",onClick:()=>k(o.indexOf(e),i,1),"aria-label":"Move down",title:"Move down",children:"â†“"}),a.jsx("button",{className:"ml-icon-btn danger",onClick:()=>R(o.indexOf(e),i),children:"Remove"})]},i))}),a.jsx("div",{className:"ml-add",children:a.jsx("input",{placeholder:"Add movie (title)",onKeyDown:t=>{t.key==="Enter"&&t.target.value.trim()&&(J(o.indexOf(e),t.target.value.trim()),t.target.value="")}})})]},s))})]})}function V({t:g}){return a.jsx($,{t:g})}export{V as default};
